================================================================================
                    AGENTS 폴더 구조 및 역할 정리
================================================================================
생성일: 2025-12-03
프로젝트: Safety Monitoring Multi-Agent System
================================================================================

📁 agents/ 폴더 개요
--------------------------------------------------------------------------------
Multi-Agent 시스템의 핵심 에이전트들이 포함된 폴더입니다.
각 에이전트는 특정 역할을 담당하며, Supervisor Agent가 전체 시스템을 조율합니다.

총 파일 수: 5개
- supervisor_agent.py (11,061 bytes)
- analysis_agent.py (7,591 bytes)
- report_agent.py (5,489 bytes)
- query_agent.py (5,231 bytes)
- __init__,py.py (323 bytes)


================================================================================
1. supervisor_agent.py - 시스템 조율 에이전트
================================================================================

📌 주요 역할:
- 전체 Multi-Agent 시스템의 중앙 조율자 (Orchestrator)
- 사용자 요청을 분석하여 적절한 하위 에이전트에게 작업 위임
- 멀티스텝 작업의 경우 여러 에이전트를 순차적으로 실행하고 결과 통합
- 단일 에이전트로 처리 가능한 작업과 복합 작업을 구분

🔧 주요 기능:
1. route(user_input: str)
   - 사용자 입력을 분석하여 라우팅 계획 수립
   - 어떤 에이전트를 사용할지, 단일/멀티스텝 작업인지 결정
   - 반환값: {"agent": "에이전트명", "query": "처리할 쿼리", "multi_step": bool}

2. execute(user_input: str)
   - 사용자 요청의 실제 실행
   - route() 결과에 따라 적절한 에이전트 호출
   - 최종 응답 반환

3. _execute_single_agent(agent_name: str, user_input: str)
   - 단일 에이전트 실행 (query, analysis, report 중 하나)
   - 에이전트별 메서드 호출 (query(), analyze(), generate_report())

4. _execute_multi_step(routing_plan: dict, original_input: str)
   - 멀티스텝 작업 실행
   - 여러 에이전트를 순차적으로 실행하고 중간 결과 수집

5. _synthesize_results(results: list, original_input: str)
   - 멀티스텝 실행 결과를 하나의 응답으로 통합
   - LLM을 사용하여 자연스러운 최종 답변 생성

📦 사용하는 하위 에이전트:
- QueryAgent: 데이터 조회
- AnalysisAgent: 데이터 분석
- ReportAgent: 보고서 생성

🎯 사용 예시:
- "가장 위험한 구역의 개선 방안을 제시해주세요" → 멀티스텝 (분석 + 보고서)
- "CAM-001의 이벤트를 보여주세요" → 단일 (조회)


================================================================================
2. query_agent.py - 데이터 조회 전담 에이전트
================================================================================

📌 주요 역할:
- 안전 모니터링 시스템의 데이터 조회 및 검색 전문가
- 카메라별, 날짜별, 이벤트 타입별 데이터 검색
- 지식 베이스(RAG)에서 관련 정보 검색

🔧 주요 기능:
1. query(user_input: str)
   - 사용자 쿼리를 처리하여 적절한 데이터 조회
   - ReAct 패턴을 사용하여 도구 선택 및 실행
   - 조회된 데이터를 명확하고 간결하게 정리하여 반환

🛠️ 사용 가능한 도구 (Tools):
- get_camera_events: 특정 카메라의 이벤트 조회
- get_all_cameras: 모든 카메라 목록 조회
- get_events_by_type: 이벤트 타입별 조회 (안전모 미착용, 넘어짐 등)
- get_events_by_date: 날짜별 이벤트 조회
- get_unresolved_events: 미해결 이벤트 조회
- search_knowledge_base: 지식 베이스 검색 (RAG)

⚙️ 기술 스택:
- LangChain ReAct Agent 패턴
- ChatGoogleGenerativeAI (Gemini Pro)
- AgentExecutor (max_iterations=5)

🎯 사용 예시:
- "CAM-001에서 발생한 이벤트를 보여주세요"
- "오늘 발생한 모든 이벤트는?"
- "안전모 미착용 이벤트가 몇 건이나 있나요?"
- "미해결 이벤트를 보여주세요"


================================================================================
3. analysis_agent.py - 데이터 분석 전담 에이전트
================================================================================

📌 주요 역할:
- 안전 모니터링 데이터의 통계 분석 및 추세 분석
- 위험도 평가 및 문제 구역 식별
- 데이터 기반 인사이트 제공

🔧 주요 기능:
1. analyze(user_input: str)
   - 사용자 분석 요청 처리
   - 2단계 프로세스:
     a) LLM에게 어떤 도구를 사용할지 계획 요청 (JSON 응답)
     b) 도구 실행 결과를 자연어로 설명

2. _get_current_date_info()
   - 현재 날짜 정보 제공 (오늘, 어제, 7일 전, 14일 전, 30일 전)
   - 상대적 날짜 표현을 구체적인 날짜로 변환하는 데 사용

🛠️ 사용 가능한 도구 (Tools):
- calculate_statistics: 기간별 통계 계산
  파라미터: start_date, end_date (YYYY-MM-DD)
  
- find_top_event_camera: 이벤트가 가장 많은 카메라 찾기
  파라미터: start_date, end_date, limit (선택)
  
- calculate_trend: 기간별 증감률 계산
  파라미터: current_start, current_end, previous_start, previous_end
  
- assess_risk_level: 위험도 평가
  파라미터: camera_id (선택), days

⚙️ 특징:
- 간소화된 버전: 직접 Tool 호출 방식 사용 (ReAct 대신)
- Temperature: 0.0 (일관성 있는 분석을 위해)
- JSON 기반 도구 선택 및 파라미터 전달

🎯 사용 예시:
- "2025-11-15부터 2025-11-22까지의 통계를 분석해주세요"
- "가장 이벤트가 많은 카메라는?"
- "최근 7일간 위험도를 평가해주세요"
- "이번 주와 지난 주의 이벤트 증감률은?"


================================================================================
4. report_agent.py - 보고서 생성 전담 에이전트
================================================================================

📌 주요 역할:
- 안전 이벤트에 대한 상세 보고서 작성
- 각 이벤트에 대한 조치 방안 제시
- 안전 규정 및 가이드라인 참조
- 전문적이고 구조화된 문서 생성

🔧 주요 기능:
1. generate_report(user_input: str)
   - 보고서 생성 요청 처리
   - ReAct 패턴을 사용하여 필요한 정보 수집 및 보고서 작성
   - 구조화된 형식으로 보고서 반환

🛠️ 사용 가능한 도구 (Tools):
- search_knowledge_base: 지식 베이스 검색
- get_action_guide: 이벤트별 조치 가이드 조회
- search_safety_regulations: 안전 규정 검색
- get_events_by_date: 날짜별 이벤트 데이터 조회
- calculate_statistics: 통계 데이터 조회

📋 보고서 구성:
1. 요약 (Summary)
2. 주요 이벤트 (Key Events)
3. 통계 (Statistics)
4. 조치 사항 (Action Items)
5. 권장 사항 (Recommendations)

⚙️ 기술 스택:
- LangChain ReAct Agent 패턴
- ChatGoogleGenerativeAI (Gemini Pro)
- Temperature: 0.3 (일관성 있는 보고서 작성)
- AgentExecutor (max_iterations=7, 보고서는 더 많은 단계 필요)

🎯 사용 예시:
- "오늘 발생한 이벤트 보고서를 작성해주세요"
- "안전모 미착용에 대한 조치 방안을 알려주세요"
- "작업자 넘어짐 사고 대응 가이드를 제공해주세요"


================================================================================
5. __init__,py.py - 모듈 초기화 파일
================================================================================

📌 주요 역할:
- agents 패키지의 초기화 및 export 관리
- 다른 모듈에서 쉽게 import할 수 있도록 설정

📦 Export 목록:
- QueryAgent
- AnalysisAgent
- ReportAgent
- SupervisorAgent

💡 사용 방법:
from agents import SupervisorAgent, QueryAgent
# 또는
from agents.supervisor_agent import SupervisorAgent


================================================================================
                        전체 시스템 아키텍처
================================================================================

사용자 요청
    ↓
SupervisorAgent (라우팅 및 조율)
    ↓
    ├─→ QueryAgent (데이터 조회)
    │   └─→ Tools: get_camera_events, get_events_by_date, etc.
    │
    ├─→ AnalysisAgent (데이터 분석)
    │   └─→ Tools: calculate_statistics, assess_risk_level, etc.
    │
    └─→ ReportAgent (보고서 생성)
        └─→ Tools: get_action_guide, search_safety_regulations, etc.


================================================================================
                        에이전트별 특성 비교
================================================================================

┌─────────────────┬──────────────┬─────────────┬──────────────┬─────────────┐
│ 에이전트        │ Temperature  │ Max Iter    │ 패턴         │ 주요 용도   │
├─────────────────┼──────────────┼─────────────┼──────────────┼─────────────┤
│ SupervisorAgent │ 0.7          │ -           │ Custom       │ 라우팅/조율 │
│ QueryAgent      │ 0.7          │ 5           │ ReAct        │ 데이터 조회 │
│ AnalysisAgent   │ 0.0          │ -           │ Direct Call  │ 데이터 분석 │
│ ReportAgent     │ 0.3          │ 7           │ ReAct        │ 보고서 생성 │
└─────────────────┴──────────────┴─────────────┴──────────────┴─────────────┘


================================================================================
                        주요 의존성 및 연결 관계
================================================================================

모든 에이전트 공통:
- config.settings: 프로젝트 설정 (API 키, 모델명 등)
- langchain_google_genai.ChatGoogleGenerativeAI: LLM 엔진

에이전트별 도구 의존성:
- QueryAgent → tools.data_tools, tools.rag_tools
- AnalysisAgent → tools.analytics_tools
- ReportAgent → tools.rag_tools, tools.data_tools, tools.analytics_tools
- SupervisorAgent → 모든 하위 에이전트 (QueryAgent, AnalysisAgent, ReportAgent)


================================================================================
                        개선 및 확장 가능성
================================================================================

1. 인증/권한 추가 시 고려사항:
   - 각 에이전트에 사용자 컨텍스트 전달 필요
   - SupervisorAgent에서 사용자 권한 확인 후 라우팅
   - 민감한 데이터 접근 제어

2. 로깅 및 모니터링:
   - 각 에이전트의 실행 시간 측정
   - 도구 호출 횟수 및 성공률 추적
   - 에러 발생 빈도 모니터링

3. 성능 최적화:
   - 에이전트 인스턴스 캐싱 (현재 SupervisorAgent만 싱글톤)
   - 도구 실행 결과 캐싱
   - 병렬 처리 가능한 작업 식별

4. 확장 가능성:
   - 새로운 전문 에이전트 추가 용이
   - 도구 추가/제거 간편
   - 멀티모달 지원 (이미지, 비디오 분석)

================================================================================
                            문서 끝
================================================================================

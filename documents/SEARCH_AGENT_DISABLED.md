================================================================================
                    웹 검색 에이전트 비활성화 설정
================================================================================
작성일: 2025-12-12
프로젝트: Safety Monitoring Multi-Agent System
================================================================================

## 📋 현재 상태

웹 검색 에이전트(SearchAgent)는 **구현은 완료되었으나 비활성화** 상태입니다.

### 이유
- DuckDuckGo의 엄격한 Rate Limit 정책으로 인해 실제 사용 불가능
- 첫 요청부터 HTTP 202 (Rate Limit) 오류 발생
- 무료 검색 서비스로는 안정적인 운영 불가능


================================================================================
## ⚙️ 비활성화 방법
================================================================================

### 1. SupervisorAgent 라우팅 수정

**파일**: `agents/supervisor_agent.py`

**변경 내용**:
1. 라우팅 프롬프트에서 search 에이전트 옵션 제거
2. report 에이전트가 외부 정보 요청도 처리하도록 설명 추가
3. search가 선택되면 자동으로 report로 대체하는 로직 추가

```python
# search 에이전트가 선택된 경우 report로 대체
if routing_plan.get("agent") == "search":
    routing_plan["agent"] = "report"
    routing_plan["reason"] = f"원래 search 선택됨 → report로 대체 (웹 검색 비활성화)"

# 멀티스텝에서도 search 제거
if routing_plan.get("multi_step") and "steps" in routing_plan:
    for step in routing_plan["steps"]:
        if step.get("agent") == "search":
            step["agent"] = "report"
            step["task"] = f"내부 지식 베이스로 답변: {step.get('task', '')}"
```


================================================================================
## 🎯 동작 방식
================================================================================

### 외부 정보 요청 시

**사용자**: "산업안전보건법 최신 개정 내용을 알려주세요"

**이전 동작** (웹 검색 활성화 시):
```
SupervisorAgent → search 에이전트 선택
→ 웹 검색 시도
→ Rate Limit 오류 발생
→ 실패
```

**현재 동작** (웹 검색 비활성화):
```
SupervisorAgent → report 에이전트 선택
→ 내부 지식 베이스(RAG) 활용
→ 안전 규정 관련 문서 검색
→ 답변 생성
```


================================================================================
## 📁 유지되는 구현
================================================================================

다음 파일들은 그대로 유지됩니다 (향후 활성화 가능):

1. **tools/web_search_tools.py**
   - 웹 검색 도구 구현
   - 개선된 Rate Limit 처리 로직
   - 향후 유료 API 통합 시 재사용 가능

2. **agents/search_agent.py**
   - 웹 검색 에이전트 구현
   - ReAct 패턴 적용
   - 완전한 기능 구현

3. **agents/__init__,py.py**
   - SearchAgent export 유지

4. **app.py**
   - /api/agents 엔드포인트에 search 정보 유지


================================================================================
## 🔄 향후 활성화 방법
================================================================================

웹 검색 기능을 다시 활성화하려면:

### 옵션 1: 유료 검색 API 사용

1. **Google Custom Search API 통합**
   ```python
   # tools/web_search_tools.py 수정
   import googleapiclient.discovery
   
   def google_custom_search(query: str) -> str:
       service = googleapiclient.discovery.build(
           "customsearch", "v1",
           developerKey=GOOGLE_API_KEY
       )
       result = service.cse().list(q=query, cx=SEARCH_ENGINE_ID).execute()
       return format_results(result)
   ```

2. **SupervisorAgent 라우팅 복원**
   - 라우팅 프롬프트에 search 옵션 다시 추가
   - search → report 대체 로직 제거

### 옵션 2: 프록시 서버 사용

1. **프록시 설정 추가**
   ```python
   # tools/web_search_tools.py
   class ImprovedDuckDuckGoSearch:
       def __init__(self, proxy=None):
           self.proxies = {
               'http': proxy,
               'https': proxy
           } if proxy else None
   ```

2. **환경 변수 설정**
   ```bash
   # .env
   PROXY_URL=http://your-proxy-server:port
   ```


================================================================================
## 📊 현재 시스템 구성
================================================================================

### 활성화된 에이전트 (3개)

1. **QueryAgent** - 데이터 조회
   - 카메라별 이벤트 조회
   - 날짜별 이벤트 조회
   - 이벤트 타입별 조회

2. **AnalysisAgent** - 데이터 분석
   - 통계 계산
   - 추세 분석
   - 위험도 평가

3. **ReportAgent** - 보고서 생성
   - 일일 보고서 작성
   - 조치 방안 제공
   - 안전 규정 안내 (내부 지식 베이스)
   - **외부 정보 요청도 처리** ⭐

### 비활성화된 에이전트 (1개)

4. **SearchAgent** - 웹 검색 (비활성화)
   - 구현 완료
   - 라우팅에서 제외
   - 향후 활성화 가능


================================================================================
## ✅ 테스트
================================================================================

### 외부 정보 요청 테스트

**테스트 쿼리**:
- "산업안전보건법 내용을 알려주세요"
- "안전모 착용 규정은?"
- "작업장 안전 관리 방법은?"

**예상 동작**:
1. SupervisorAgent가 report 에이전트 선택
2. ReportAgent가 내부 지식 베이스(RAG) 검색
3. 관련 문서 기반 답변 생성
4. 사용자에게 응답 반환

**확인 방법**:
- 터미널에서 라우팅 로그 확인
- "report 에이전트" 선택 확인
- "search 에이전트" 선택되지 않음 확인


================================================================================
## 📝 요약
================================================================================

✅ **구현 완료**: 웹 검색 에이전트 코드 완성
⚠️ **현재 상태**: 비활성화 (라우팅에서 제외)
🔄 **대체 방안**: report 에이전트가 내부 지식 베이스로 처리
🚀 **향후 계획**: 유료 API 또는 프록시 사용 시 재활성화 가능

**장점**:
- 시스템 안정성 확보
- 내부 지식 베이스 활용
- 코드는 유지되어 향후 활성화 용이

**단점**:
- 실시간 최신 정보 제공 불가
- 외부 웹 검색 기능 미제공

================================================================================
                             문서 끝
================================================================================

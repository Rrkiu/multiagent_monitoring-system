================================================================================
                    웹 검색 에이전트 (Search Agent) 가이드
================================================================================
생성일: 2025-12-12
프로젝트: Safety Monitoring Multi-Agent System
================================================================================

📌 개요
--------------------------------------------------------------------------------
웹 검색 에이전트는 외부 정보가 필요한 질문에 답변하기 위해 웹에서 정보를 
검색하고 요약하는 전문 에이전트입니다.

기존 시스템이 내부 데이터베이스와 지식 베이스에 의존했다면, 이제 웹 검색을 
통해 최신 정보, 법규, 뉴스, 기술 문서 등을 실시간으로 수집할 수 있습니다.


================================================================================
1. 주요 기능
================================================================================

🔍 웹 검색 도구 (Web Search Tools)
--------------------------------------------------------------------------------
파일: tools/web_search_tools.py

1. web_search
   - 일반 웹 검색 (최대 5개 결과)
   - 한국어/영어 검색 지원
   - 사용 예: "산업안전보건법 최신 개정 내용"

2. detailed_web_search
   - 상세 웹 검색 (최대 10개 결과)
   - 심층적인 조사가 필요한 경우
   - 사용 예: "작업장 안전 관리 체계 구축 방법"

3. search_safety_news
   - 안전 관련 최신 뉴스 검색
   - 자동으로 "안전 뉴스" 키워드 추가
   - 사용 예: "최근 건설 현장 안전사고"

4. search_safety_regulations
   - 안전 규정 및 법규 검색
   - 자동으로 "산업안전보건법 OR OSHA" 키워드 추가
   - 사용 예: "추락 방지 안전 규정"


🤖 검색 에이전트 (Search Agent)
--------------------------------------------------------------------------------
파일: agents/search_agent.py

주요 메서드:
- search(user_input: str) -> str
  웹 검색을 수행하고 결과를 요약하여 반환

- search_with_context(query: str, context: str) -> str
  추가 컨텍스트를 고려한 검색 수행

특징:
- ReAct 패턴 사용 (Reasoning + Acting)
- 최대 6번의 반복 (복잡한 검색 가능)
- Temperature: 0.5 (창의성과 정확성 균형)
- 자동 오류 처리


================================================================================
2. 시스템 통합
================================================================================

📊 에이전트 구조
--------------------------------------------------------------------------------
기존: query, analysis, report (3개 에이전트)
추가: search (웹 검색 에이전트)

SupervisorAgent가 사용자 요청을 분석하여 적절한 에이전트로 라우팅:

사용자 요청
    ↓
SupervisorAgent (라우팅)
    ↓
    ├─→ query (내부 데이터 조회)
    ├─→ analysis (데이터 분석)
    ├─→ report (보고서 생성)
    └─→ search (웹 검색) ⭐ NEW


🔄 라우팅 로직
--------------------------------------------------------------------------------
SupervisorAgent는 다음과 같은 경우 search 에이전트를 선택합니다:

1. 최신 정보가 필요한 경우
   - "최근 안전사고 사례"
   - "2025년 안전 규정 변경사항"

2. 외부 규정/법규 조회
   - "산업안전보건법 개정 내용"
   - "OSHA 추락 방지 규정"

3. 기술 문서/가이드라인
   - "작업장 안전 체크리스트"
   - "안전모 착용 기준"

4. 뉴스 및 사례
   - "최근 건설 현장 사고"
   - "안전 관리 우수 사례"


================================================================================
3. 사용 예시
================================================================================

🎯 단일 검색 (Single Step)
--------------------------------------------------------------------------------
사용자: "산업안전보건법 최신 개정 내용을 알려주세요"

처리 과정:
1. SupervisorAgent가 요청 분석
2. search 에이전트 선택
3. 웹에서 관련 정보 검색
4. 결과 요약하여 반환

예상 응답:
"""
산업안전보건법 최신 개정 내용:

1. 중대재해처벌법 연계 강화 (2024년)
   - 사업주 안전 의무 강화
   - 처벌 수위 상향

2. 안전보건관리체계 구축 의무화
   - 50인 이상 사업장 대상
   - 위험성 평가 의무화

3. 산업재해 예방 조치 강화
   ...

출처: 고용노동부, 안전보건공단
"""


🔗 멀티스텝 검색 (Multi-Step)
--------------------------------------------------------------------------------
사용자: "최신 안전 규정에 따른 우리 작업장 개선 방안을 제시해주세요"

처리 과정:
1. SupervisorAgent가 멀티스텝으로 판단
2. Step 1: search 에이전트 - 최신 안전 규정 검색
3. Step 2: analysis 에이전트 - 현재 작업장 데이터 분석
4. Step 3: report 에이전트 - 개선 방안 보고서 작성
5. 결과 통합하여 반환


================================================================================
4. API 엔드포인트
================================================================================

GET /api/agents
--------------------------------------------------------------------------------
사용 가능한 에이전트 목록 반환 (search 포함)

응답 예시:
{
  "agents": [
    {
      "name": "search",
      "description": "웹 검색 전담 에이전트",
      "capabilities": [
        "최신 안전 규정 검색",
        "안전 관련 뉴스 조회",
        "기술 문서 검색",
        "외부 정보 수집"
      ]
    },
    ...
  ]
}


POST /api/query
--------------------------------------------------------------------------------
사용자 쿼리 처리 (search 에이전트 자동 라우팅)

요청:
{
  "query": "산업안전보건법 최신 개정 내용",
  "session_id": "optional"
}

응답:
{
  "response": "검색 결과 요약...",
  "session_id": "optional"
}


================================================================================
5. 설치 및 설정
================================================================================

📦 필수 라이브러리
--------------------------------------------------------------------------------
requirements.txt에 추가된 라이브러리:
- duckduckgo-search==4.1.1

설치 방법:
```bash
pip install -r requirements.txt
```

또는 개별 설치:
```bash
pip install duckduckgo-search==4.1.1
```


⚙️ 환경 설정
--------------------------------------------------------------------------------
.env 파일에 필요한 설정:
- GOOGLE_API_KEY: Gemini API 키 (기존)
- 추가 설정 불필요 (DuckDuckGo는 API 키 불필요)


================================================================================
6. 테스트
================================================================================

🧪 단위 테스트
--------------------------------------------------------------------------------
SearchAgent 단독 테스트:

```bash
python agents/search_agent.py
```

테스트 쿼리:
- "산업안전보건법 최신 개정 내용"
- "작업장 안전모 착용 규정"
- "추락 방지 안전 가이드라인"


🔄 통합 테스트
--------------------------------------------------------------------------------
전체 시스템 테스트:

```bash
python app.py
```

브라우저에서 http://localhost:8000 접속
프론트엔드에서 검색 관련 질문 입력


================================================================================
7. 주의사항 및 제한사항
================================================================================

⚠️ 주의사항
--------------------------------------------------------------------------------
1. 검색 속도
   - 웹 검색은 내부 데이터 조회보다 느릴 수 있음
   - 평균 응답 시간: 3-10초

2. 검색 결과 품질
   - DuckDuckGo 검색 엔진 의존
   - 검색어 품질에 따라 결과 차이 발생

3. 언어 지원
   - 한국어/영어 검색 지원
   - 한국 지역 우선 검색 (region="kr-kr")

4. API 제한
   - DuckDuckGo는 API 키 불필요
   - 과도한 요청 시 일시적 차단 가능


🔒 제한사항
--------------------------------------------------------------------------------
1. 실시간 정보
   - 검색 엔진 인덱싱 시간 차이로 최신 정보가 아닐 수 있음

2. 검색 결과 수
   - 일반 검색: 최대 5개
   - 상세 검색: 최대 10개

3. 콘텐츠 접근
   - 로그인이 필요한 사이트는 검색 불가
   - PDF, 동영상 등 특수 형식 제한적


================================================================================
8. 향후 개선 방향
================================================================================

🚀 계획된 개선사항
--------------------------------------------------------------------------------
1. 검색 엔진 다양화
   - Google Custom Search API 추가
   - Bing Search API 추가
   - 여러 검색 엔진 결과 통합

2. 검색 결과 캐싱
   - 동일 쿼리 반복 검색 방지
   - Redis 또는 메모리 캐시 활용

3. 검색 품질 개선
   - 검색어 최적화 로직 추가
   - 결과 필터링 및 랭킹 개선

4. 특화 검색
   - 이미지 검색
   - 동영상 검색
   - 학술 논문 검색


================================================================================
9. 문제 해결
================================================================================

❓ 자주 묻는 질문
--------------------------------------------------------------------------------
Q1: 검색이 너무 느려요
A: DuckDuckGo 서버 상태에 따라 속도가 다를 수 있습니다.
   max_results를 줄이거나 다른 검색 엔진 추가를 고려하세요.

Q2: 검색 결과가 부정확해요
A: 검색어를 더 구체적으로 작성하거나, detailed_web_search를 사용하세요.

Q3: 한국어 검색 결과가 적어요
A: region 설정을 확인하고, 영어 키워드도 함께 사용해보세요.


🐛 오류 해결
--------------------------------------------------------------------------------
오류: "duckduckgo_search module not found"
해결: pip install duckduckgo-search==4.1.1

오류: "검색 중 오류 발생"
해결: 네트워크 연결 확인, 방화벽 설정 확인

오류: "Too many requests"
해결: 잠시 대기 후 재시도, 검색 빈도 조절


================================================================================
10. 예제 쿼리
================================================================================

✅ 추천 쿼리
--------------------------------------------------------------------------------
1. 법규/규정
   - "산업안전보건법 제38조 내용"
   - "OSHA 1926.501 추락 방지 규정"
   - "중대재해처벌법 적용 대상"

2. 최신 뉴스
   - "2025년 1월 안전사고 통계"
   - "최근 건설 현장 안전 강화 조치"
   - "안전보건공단 새로운 지침"

3. 기술 문서
   - "작업장 위험성 평가 방법"
   - "안전보건관리체계 구축 가이드"
   - "개인보호구 선정 기준"

4. 사례 연구
   - "안전 관리 우수 기업 사례"
   - "산업재해 예방 성공 사례"
   - "스마트 안전 관리 시스템 도입 사례"


================================================================================
                             문서 끝
================================================================================
